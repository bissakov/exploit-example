from django import template
import base64
import pickle
from django.http import HttpResponse
import struct

def convert_string_to_bytes(string):
    bytes = b''
    for i in string:
        bytes += struct.pack("B", ord(i))
    return bytes   

register = template.Library()

@register.simple_tag(takes_context = True)
def cookie(context, cookie_name):
    request = context['request']
    if request.COOKIES.get(cookie_name) is not None:
        result = request.COOKIES.get(cookie_name)
        if 'b\'' in result:
            result = result[2:len(result) - 1]
        padding = 4 - (len(result) % 4)
        result = result + ('=' * padding)
        result = convert_string_to_bytes(result)
        return pickle.loads(base64.urlsafe_b64decode(result))
    else:
        return 'None'